{
  "meta": {
    "description": "MGB Dash 2026 — Master CAN ID definitions (single source of truth)",
    "bus_speed_kbps": 500,
    "id_format": "11-bit standard",
    "custom_id_range": { "min": "0x700", "max": "0x73F" }
  },

  "custom_ids": {
    "0x700": {
      "name": "HEARTBEAT",
      "source": "all",
      "rate_hz": 1,
      "description": "Module heartbeat — all modules broadcast on this ID",
      "payload": {
        "bytes_0_4": "Role name ASCII, space-padded (FUEL , AMPS , TEMP , SPEED, BODY , DASH , GPS  )",
        "byte_5": "Rolling uptime counter (0–255, wraps)",
        "byte_6": "Error flags bitfield (reserved)",
        "byte_7": "Reserved (0x00)"
      }
    },
    "0x710": {
      "name": "BODY_STATE",
      "source": "body_controller",
      "rate_hz": 10,
      "description": "Vehicle state bit flags",
      "payload": {
        "byte_0": {
          "bit_0": "KEY_ON",
          "bit_1": "BRAKE",
          "bit_2": "REGEN",
          "bit_3": "FAN",
          "bit_4": "REVERSE",
          "bit_5": "LEFT_TURN",
          "bit_6": "RIGHT_TURN",
          "bit_7": "HAZARD"
        },
        "bytes_1_7": "Reserved (0x00)"
      }
    },
    "0x711": {
      "name": "BODY_SPEED",
      "source": "body_controller",
      "rate_hz": 10,
      "description": "Vehicle speed from hall sensor (authority source)",
      "payload": {
        "bytes_0_7": "64-bit double, speed in mph"
      }
    },
    "0x712": {
      "name": "BODY_GEAR",
      "source": "body_controller",
      "rate_hz": 2,
      "description": "Estimated gear from motor RPM / driveshaft RPM ratio",
      "payload": {
        "byte_0": "Gear number (1–4) or 0=Neutral or 0xFF=Unknown",
        "byte_1": "Reverse flag (0 or 1)",
        "bytes_2_7": "Reserved (0x00)"
      }
    },
    "0x713": {
      "name": "BODY_ODOMETER",
      "source": "body_controller",
      "rate_hz": 1,
      "description": "Odometer reading",
      "payload": {
        "bytes_0_3": "32-bit unsigned integer, total miles (little-endian)",
        "bytes_4_7": "Reserved (0x00)"
      }
    },
    "0x720": {
      "name": "GPS_SPEED",
      "source": "gps_display",
      "rate_hz": 2,
      "description": "GPS speed",
      "payload": { "bytes_0_7": "64-bit double, speed in mph" }
    },
    "0x721": {
      "name": "GPS_TIME",
      "source": "gps_display",
      "rate_hz": 2,
      "description": "GPS time (seconds since midnight UTC)",
      "payload": { "bytes_0_7": "64-bit double, seconds since midnight UTC" }
    },
    "0x722": {
      "name": "GPS_DATE",
      "source": "gps_display",
      "rate_hz": 2,
      "description": "GPS date (days since epoch 2000-01-01)",
      "payload": { "bytes_0_7": "64-bit double, days since 2000-01-01" }
    },
    "0x723": {
      "name": "GPS_LATITUDE",
      "source": "gps_display",
      "rate_hz": 2,
      "description": "GPS latitude",
      "payload": { "bytes_0_7": "64-bit double, decimal degrees (negative = south)" }
    },
    "0x724": {
      "name": "GPS_LONGITUDE",
      "source": "gps_display",
      "rate_hz": 2,
      "description": "GPS longitude",
      "payload": { "bytes_0_7": "64-bit double, decimal degrees (negative = west)" }
    },
    "0x725": {
      "name": "GPS_ELEVATION",
      "source": "gps_display",
      "rate_hz": 2,
      "description": "GPS elevation",
      "payload": { "bytes_0_7": "64-bit double, meters above sea level" }
    },
    "0x726": {
      "name": "GPS_AMBIENT_LIGHT",
      "source": "gps_display",
      "rate_hz": 2,
      "description": "Ambient light category from time relative to sunset",
      "payload": {
        "byte_0": "0=DAYLIGHT, 1=EARLY_TWILIGHT, 2=LATE_TWILIGHT, 3=DARKNESS",
        "bytes_1_7": "Reserved (0x00)"
      }
    },
    "0x727": {
      "name": "GPS_UTC_OFFSET",
      "source": "gps_display",
      "rate_hz": 2,
      "description": "UTC offset in minutes (signed, e.g. -300=EST, -240=EDT)",
      "payload": {
        "bytes_0_1": "int16 signed little-endian, UTC offset in minutes",
        "bytes_2_7": "Reserved (0x00)"
      }
    },
    "0x730": {
      "name": "SELF_TEST",
      "source": "any",
      "rate_hz": "on-demand",
      "description": "Triggers self-test on receiving modules. ESP32 gauges: needle sweep + LED ring pattern. Raspberry Pis: TBD display/system test.",
      "payload": {
        "byte_0": "Target module: 0xFF=ALL, or ASCII first char of role name (F=FUEL, A=AMPS, T=TEMP, S=SPEED, B=BODY, D=DASH, G=GPS)",
        "bytes_1_7": "Reserved (0x00)"
      }
    },
    "0x731": {
      "name": "LOG",
      "source": "any",
      "rate_hz": "on-demand",
      "description": "Structured log event — compact event code with context value and optional text continuation via LOG_TEXT frames",
      "payload": {
        "byte_0": "role(4 high bits) | level(4 low bits)",
        "byte_1": "event code (LogEvent enum, uint8)",
        "bytes_2_5": "context value (uint32, big-endian)",
        "byte_6": "reserved (0x00)",
        "byte_7": "text_frames_following (0–7)"
      }
    },
    "0x732": {
      "name": "LOG_TEXT",
      "source": "any",
      "rate_hz": "on-demand",
      "description": "Optional string continuation for LOG (0x731). Up to 7 frames = 49 ASCII characters.",
      "payload": {
        "byte_0": "fragment index (0–6)",
        "bytes_1_7": "7 ASCII chars, null-padded"
      }
    }
  },

  "leaf_ids": {
    "0x1DA": {
      "name": "LEAF_MOTOR_STATUS",
      "description": "Motor RPM, torque, fail-safe status",
      "signals": {
        "MotorRPM": { "py_key": "motor_rpm", "start_byte": 1, "start_bit": 0, "length_bits": 16, "signed": true, "factor": 1, "offset": 0, "unit": "RPM", "notes": "bytes 1-2, big-endian signed" },
        "AvailableTorque": { "py_key": "available_torque_nm", "start_byte": 3, "start_bit": 0, "length_bits": 10, "signed": false, "factor": 0.5, "offset": -400, "unit": "Nm" },
        "FailSafe": { "py_key": "failsafe", "start_byte": 6, "start_bit": 2, "length_bits": 2, "signed": false }
      }
    },
    "0x1DB": {
      "name": "LEAF_BATTERY_STATUS",
      "description": "Battery voltage, current, SOC",
      "signals": {
        "BatteryVoltage": { "py_key": "battery_voltage_v", "start_byte": 0, "start_bit": 0, "length_bits": 10, "signed": false, "factor": 0.5, "offset": 0, "unit": "V", "notes": "bytes 0-1 upper 10 bits, big-endian" },
        "BatteryCurrent": { "py_key": "battery_current_a", "start_byte": 2, "start_bit": 0, "length_bits": 11, "signed": true, "factor": 0.5, "offset": 0, "unit": "A", "notes": "bytes 2-3 upper 11 bits, big-endian, positive = discharge" },
        "SOC": { "py_key": "soc_percent", "start_byte": 4, "start_bit": 0, "length_bits": 8, "signed": false, "factor": 1, "offset": 0, "unit": "%", "notes": "Usable SOC" }
      }
    },
    "0x55A": {
      "name": "LEAF_INVERTER_TEMPS",
      "description": "Motor and inverter temperatures",
      "signals": {
        "MotorTemperature": { "py_key": "motor_temp_c", "start_byte": 0, "start_bit": 0, "length_bits": 8, "signed": false, "factor": 0.5, "offset": 0, "unit": "\u00b0C" },
        "IGBTTemperature": { "py_key": "igbt_temp_c", "start_byte": 1, "start_bit": 0, "length_bits": 8, "signed": false, "factor": 0.5, "offset": 0, "unit": "\u00b0C" },
        "InverterComBoardTemp": { "py_key": "inverter_temp_c", "start_byte": 2, "start_bit": 0, "length_bits": 8, "signed": false, "factor": 0.5, "offset": 0, "unit": "\u00b0C" }
      }
    },
    "0x55B": {
      "name": "LEAF_SOC_PRECISE",
      "description": "High-precision SOC",
      "signals": {
        "SOC_Precise": { "py_key": "soc_precise_percent", "start_byte": 0, "start_bit": 0, "length_bits": 16, "signed": false, "factor": 0.01, "offset": 0, "unit": "%", "notes": "bytes 0-1, big-endian, divide by 100 for %" }
      }
    },
    "0x5BC": {
      "name": "LEAF_BATTERY_HEALTH",
      "description": "Battery capacity, SOH, GIDs",
      "signals": {
        "GIDs": { "py_key": "gids", "start_byte": 0, "start_bit": 0, "length_bits": 10, "signed": false, "factor": 1, "offset": 0, "unit": "GIDs", "notes": "bytes 0-1 upper 10 bits" },
        "SOH": { "py_key": "soh_percent", "start_byte": 4, "start_bit": 1, "length_bits": 7, "signed": false, "factor": 1, "offset": 0, "unit": "%", "notes": "byte 4 bits 1-7" }
      }
    },
    "0x5C0": {
      "name": "LEAF_BATTERY_TEMP",
      "description": "Battery pack temperature",
      "signals": {
        "BatteryTemp": { "py_key": "battery_temp_c", "start_byte": 0, "start_bit": 0, "length_bits": 8, "signed": true, "factor": 1, "offset": -40, "unit": "\u00b0C", "notes": "byte 0, offset -40 (raw + offset = \u00b0C)" }
      }
    },
    "0x1DC": {
      "name": "LEAF_CHARGER",
      "description": "Charger/OBC status and power",
      "signals": {
        "ChargePower": { "py_key": "charge_power_kw", "start_byte": 0, "start_bit": 0, "length_bits": 10, "signed": false, "factor": 0.25, "offset": 0, "unit": "kW", "notes": "bytes 0-1 upper 10 bits" }
      }
    },
    "0x390": {
      "name": "LEAF_VCM",
      "description": "VCM operational status",
      "signals": {
        "VCMMainRelay": { "py_key": "main_relay_closed", "start_byte": 4, "start_bit": 0, "length_bits": 1, "signed": false, "notes": "1 = main relay closed" }
      }
    },
    "0x59E": {
      "name": "LEAF_AZE0_ID",
      "description": "Present only on AZE0 (2013\u20132017) Leaf \u2014 used for generation detection",
      "signals": {}
    }
  },

  "resolve_ids": {
    "0x539": {
      "name": "RESOLVE_DISPLAY",
      "description": "Resolve EV Controller display message",
      "signals": {
        "Gear": { "py_key": "gear", "start_byte": 0, "start_bit": 0, "length_bits": 4, "signed": false },
        "IgnitionOn": { "py_key": "ignition_on", "start_byte": 0, "start_bit": 4, "length_bits": 1, "signed": false },
        "SystemOn": { "py_key": "system_on", "start_byte": 0, "start_bit": 5, "length_bits": 1, "signed": false },
        "DisplayMaxChargeOn": { "py_key": "display_max_charge_on", "start_byte": 0, "start_bit": 6, "length_bits": 1, "signed": false },
        "RegenStrength": { "py_key": "regen_strength", "start_byte": 1, "start_bit": 0, "length_bits": 8, "signed": false },
        "SOCforDisplay": { "py_key": "soc_percent", "start_byte": 2, "start_bit": 0, "length_bits": 8, "signed": false, "unit": "%" }
      }
    }
  },

  "heartbeat_roles": [
    { "name": "FUEL ", "description": "Fuel/SOC servo gauge" },
    { "name": "AMPS ", "description": "Amps servo gauge" },
    { "name": "TEMP ", "description": "Temperature servo gauge" },
    { "name": "SPEED", "description": "Speedometer gauge" },
    { "name": "BODY ", "description": "Body controller" },
    { "name": "DASH ", "description": "Primary display Pi" },
    { "name": "GPS  ", "description": "GPS display Pi" }
  ]
}
