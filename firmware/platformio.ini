; MGB Dash 2026 — PlatformIO Multi-Environment Configuration
;
; Build all:    pio run
; Build one:    pio run -e servo_fuel
; Flash one:    pio run -e servo_fuel -t upload

[platformio]
default_envs = servo_fuel, servo_amps, servo_temp, speedometer, body_controller

; ── Shared defaults ────────────────────────────────────────────────
[env]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
lib_deps =
    fastled/FastLED@^3.6.0
    madhephaestus/ESP32Servo@^1.1.2
build_flags =
    -I../common/cpp
    -DCAN_TX_PIN=21
    -DCAN_RX_PIN=22
    -DLED_DATA_PIN=13
    -DLED_COUNT=24
    -DSERVO_PIN=14

; ── Servo Gauges ───────────────────────────────────────────────────
[env:servo_fuel]
build_src_filter = +<servo_gauge/>
build_flags =
    ${env.build_flags}
    -DGAUGE_ROLE=FUEL
    -DGAUGE_ROLE_NAME='"FUEL "'

[env:servo_amps]
build_src_filter = +<servo_gauge/>
build_flags =
    ${env.build_flags}
    -DGAUGE_ROLE=AMPS
    -DGAUGE_ROLE_NAME='"AMPS "'

[env:servo_temp]
build_src_filter = +<servo_gauge/>
build_flags =
    ${env.build_flags}
    -DGAUGE_ROLE=TEMP
    -DGAUGE_ROLE_NAME='"TEMP "'

; ── Speedometer ────────────────────────────────────────────────────
[env:speedometer]
build_src_filter = +<speedometer/>
build_flags =
    ${env.build_flags}
    -DGAUGE_ROLE=SPEED
    -DGAUGE_ROLE_NAME='"SPEED"'
    ; Stepper motor (A4988/DRV8825)
    -DSTEPPER_STEP_PIN=25
    -DSTEPPER_DIR_PIN=26
    -DSTEPPER_EN_PIN=27
    ; eInk display (Waveshare 1.54" tri-color, SPI)
    -DEINK_MOSI_PIN=23
    -DEINK_SCK_PIN=18
    -DEINK_CS_PIN=5
    -DEINK_DC_PIN=17
    -DEINK_RST_PIN=16
    -DEINK_BUSY_PIN=4

; ── Body Controller ────────────────────────────────────────────────
[env:body_controller]
build_src_filter = +<body_controller/>
build_flags =
    ${env.build_flags}
    -DGAUGE_ROLE=BODY
    -DGAUGE_ROLE_NAME='"BODY "'
    -DHALL_SENSOR_PIN=27
    -DKEY_ON_PIN=32
    -DBRAKE_PIN=33
    -DREGEN_PIN=25
    -DFAN_PIN=26
    -DREVERSE_PIN=34
    -DLEFT_TURN_PIN=35
    -DRIGHT_TURN_PIN=36
    ; Drivetrain constants
    -DDIFF_RATIO=3.96
    -DTIRE_DIAMETER_IN=14.0
    ; MGB 4-speed gear ratios
    -DGEAR_RATIO_1=3.44
    -DGEAR_RATIO_2=2.17
    -DGEAR_RATIO_3=1.38
    -DGEAR_RATIO_4=1.00
    -DGEAR_TOLERANCE=0.15
    ; Odometer persistence
    -DODO_PERSIST_MILES=0.5
